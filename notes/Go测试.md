# Go测试

Go包含一个testing包，用来为代码编写自动化测试。还有一个go test命令，用来运行这些测试。



## 测试文件说明

测试文件需要注意的地方：

- 测试文件名，必须以`_test.go`结尾，go test工具查找以该后缀命名的文件。
- 如果想从包中访问未导出的类型或函数，必须将测试文件的代码与正在测试的代码放在同一个包中。
- 每个测试文件的顶部到需要导入testing包。
- 测试文件中的测试函数名，必须以Test开头（首字母大写）。并且每个测试函数都应该接受单个参数：一个指向testing.T值的指针。以便在测试函数中，通过对testing.T值调用相关的方法来报告测试失败。
- 测试文件中，不一定全部都是测试函数，不是以Test开头的普通函数，也可以放在测试文件中。go test命令只使用名称以Test开头的函数。

示例：

```go
import "testing"

func TestTwoElements(t *testing.T) {
	t.Error("报告错误")
}
```



## go test 命令

要运行测试，可以使用go test命令。

该命令采用一个或多个包的导入路径，就像go install或go doc一样。它将在那些包目录中找到所有名字以_test.go结尾的文件，并运行名字以Test开头的文件中包含的每个函数。

go test命令被设置为只处理名称以`_test.go`结尾的文件一样。go工具中的其他各种命令（比如go build和go install）都被设置为忽略名称以`_test.go`结尾的文件。go工具可以将你的程序代码编译成一个可执行文件，但是它将忽略测试代码，即使它保存在相同的包目录中。

### go test 命令选项

#### -v

如果指定-v参数，将列出运行的每个测试函数的名称和状态。v是verbose的缩写。

#### -run

可以添加-run选项来限制正在运行的测试集。在-run之后，指定部分或全部函数名，这样就只运行名称与指定的名称匹配的测试函数。

例如：如果我们将-run Two添加到go run命令中，那么只有名称中包含Two的测试函数才会匹配。



## Errorf 函数

测试函数的testing.T参数还有一个可以调用的Errorf方法。与Error不同，Errorf接受一个带格式化动词的字符串，就像fmt.Printf和fmt.Sprintf函数一样。可以使用Errorf在测试的失败消息中包含其他信息，例如传递给函数的参数、得到的返回值和期望的值。

Errorf的使用方式和fmt.Printf一样。